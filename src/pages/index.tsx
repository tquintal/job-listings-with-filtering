import Head from "next/head";
import { useState } from "react";
import Filter from "~/components/Filter";
import Header from "~/components/Header";
import JobCard from "~/components/JobCard";
import { type Tag } from "~/types/types";
import { api } from "~/utils/api";

export default function Home() {
  const [filter, setFilter] = useState<Tag[] | null>();

  const { data: jobListings } = api.job.getJobs.useQuery(filter);

  const addFilterHandler = (tag: Tag) => {
    if (filter?.find((val) => val.id === tag.id)) return;
    setFilter((prev) => {
      if (prev) return [...prev, tag];
      return [tag];
    });
  };

  return (
    <>
      <Head>
        <title>Job Listings</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.png" />
      </Head>
      <main className="relative flex flex-col items-center">
        <Header />
        <div
          className={`absolute top-32 flex w-full max-w-[1440px] flex-col items-center gap-6 pb-12 max-2xl:pl-14 max-2xl:pr-14 max-lg:gap-12 max-lg:pl-6 max-lg:pr-6 ${filter ? "" : "mt-16"}`}
        >
          {filter && <Filter filter={filter} setFilter={setFilter} />}
          {jobListings?.map((job) => (
            <JobCard
              key={job.id}
              job={job}
              addFilterHandler={(tag) => addFilterHandler(tag)}
            />
          ))}
        </div>
      </main>
    </>
  );
}
